# AI 駆動開発：標準化と再発防止のベストプラクティス (SOP)

AI エージェントと共に、高品質なアプリケーションを爆速で開発、保守するための標準ガイドラインです。

## 1. プロジェクトの「型」の標準化

新しいプロジェクトを立ち上げる際、以下の 3 つのドキュメントを必須コンポーネントとして配置します。

### ① `.agent/workflows/` (行動ルールの辞書)

プロジェクト固有のルーティンをワークフローとして定義します。

- `review.md`: レビューダッシュボードの更新基準と項目生成ルール。
- `coding_style.md`: 使用するフレームワーク、命名規則、コンポーネント設計指針。
- `deploy.md`: テスト、ビルド、デプロイの具体的な手順。

### ② `evolution_history.md` (進化の系譜)

単なるコミットログではなく、「意思決定の意図」を記録します。

- `[P]`: Planning（背景・意図）
- `[D]`: Design/Decision（設計判断・採択した技術）
- `[C]`: Challenge/Constraint（直面した課題・制約）
- `[A]`: Action/Achievement（実施内容・成果）
  **目的**: AI の「先祖返り」を防ぎ、過去の失敗を文脈として共有する。
  **運用**: 更新時は `scripts/prompts/evolution_history_instruction.md` の指示に従うこと。

### ③ `implementation_plan.md` (事前承認プロトコル)

大規模な変更を行う前に、必ずエージェントに詳細な計画を作成させ、ユーザーの承認を得るルーティンを徹底します。

---

## 2. 誤りの是正（Correction）ルーティン

誤りが発生した際は、感情的な指示ではなく「システム的な是正」を行います。

1.  **レビュー・ダッシュボードの活用**: チャットでの「直しました」報告を禁止し、必ずアプリ内の `/review` ページにチェック項目を生成させ、実機でのエビデンスを元に会話する。
2.  **型とテストによる拘束**: 誤りが起きた箇所に対して、TypeScript の型定義を厳格化する、あるいはバリデーション（Pydantic 等）を追加し、プログラム的に誤りを検知できる構造に書き換える。

---

## 3. 再発防止（Prevention）の 3 ステップ

同じミスを二度起こさないためのポストモーテル（事後分析）手順です。

1.  **原因の記述**: 何が原因だったか（例：CSS セレクタの指定が広すぎた）を明確にする。
2.  **ガードレールの設置**:
    - **技術的**: 共通関数化、Linter ルールの追加。
    - **行動的**: `.agent/workflows/` への追記（「〇〇を編集する際は必ず XX を確認すること」）。
3.  **記憶の定着**: `evolution_history.md` に再発防止策を明記し、次回以降のプロンプト・コンテキストに含める。

---

## 4. 開発サイクルの標準フロー

1.  **要求**: ユーザーが要望を伝える。
2.  **計画**: エージェントが `implementation_plan.md` を提案。
3.  **承認**: ユーザーが計画をレビュー・承認。
4.  **実行**: エージェントがコードを書き、`/review` 項目を生成。
5.  **検証**: ユーザーがダッシュボードでチェックし「合格」を出す。
6.  **完了**: `evolution_history.md` を更新し、GitHub へプッシュ。

---

## 5. 品質管理（QC）サマリー

AI 開発を「製造現場」と捉えた、品質保証の全体像です。

| フェーズ   | ツール / 手法                | 目的 (QC 視点)                     | 具体的アクション                                  |
| :--------- | :--------------------------- | :--------------------------------- | :------------------------------------------------ |
| **開始前** | `.agent/workflows/`          | **標準化**: 現場のルールを教え込む | コーディング規約、デプロイ手順の読み込み。        |
| **設計時** | `implementation_plan.md`     | **安全**: 作業前のリスク予知 (KY)  | AI が設計図を提示。人間が「デグレの有無」を承認。 |
| **開発中** | 厳格な型 & 自動テスト        | **品質**: 工程内検査 (自働化)      | AI が書いたコードがテストをパスするか自動検証。   |
| **完了時** | **レビュー・ダッシュボード** | **品質**: 最終検品 (**三現主義**)  | UI 上のチェックボックスと証拠画像で動作を確認。   |
| **終了後** | `evolution_history.md`       | **再発防止**: 知見の標準化と横展開 | 失敗事例を「事故記録」として残し、全社展開。      |

---

## 6. AI コードレビュー・システム

GitHub Actions と Gemini 2.5 Pro を連携させた自動レビューを導入しています。

### レビューの 3 観点

1. **脆弱性**: セキュリティリスクの早期発見（認証、インジェクション等）。
2. **パフォーマンス**: 非効率な処理の検知（N+1、重いループ、メモリ管理）。
3. **設計**: アーキテクチャ遵守とクリーンコード（依存関係、DRY 原則）。

### 運用フロー

- PR 作成・更新時にワークフローが自動実行され、『repomix』でバンドルされたプロジェクト全体がレビューされます。
- レビュー結果は PR のコメントとして投稿されます。
- 重大な指摘がある場合は、必ず修正または人間による確認（Resolve）を行ってからマージしてください。

> [!IMPORTANT]
> このドキュメント自体も「常に変化する」ものです。新しい教訓が得られるたびに更新し、プロジェクトの「知恵」を蓄積してください。
